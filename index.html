<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LoveLens AI - Your Love Analyzer ðŸ’–</title>
    <style>
        :root {
            --pink-1: #ffb6c1;  /* Light pink */
            --pink-2: #ff69b4;  /* Hot pink */
            --pink-3: #ff1493;  /* Deep pink */
            --text: #8b0058;    /* Romantic purple-pink */
            --bg-gradient: linear-gradient(135deg, #fff0f5, #ffe4e1);
            --font-color: #5d2a5e; /* New dark font color */
        }

        body {
            background: var(--bg-gradient);
            font-family: 'Arial', sans-serif;
            color: var(--font-color);
            text-align: center;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 0;
        }

        h1 {
            color: var(--pink-3);
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255, 182, 193, 0.6);
            animation: fadeIn 1s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .upload-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
            max-width: 600px;
        }

        .upload-zone {
            border: 2px dashed var(--pink-2);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            transition: all 0.3s;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .upload-zone:hover {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.4);
        }

        #previewImage {
            max-width: 100%;
            max-height: 300px;
            border-radius: 15px;
            display: none;
            margin-top: 15px;
            border: 2px solid var(--pink-2);
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
        }

        .analyze-btn {
            background: linear-gradient(45deg, var(--pink-2), var(--pink-3));
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3);
            position: relative;
        }

        .analyze-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 105, 180, 0.7);
        }

        .loading {
            display: none;
            margin: 30px 0;
            text-align: center;
        }

        .loading-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
        }

        .dot {
            width: 12px;
            height: 12px;
            background: var(--pink-2);
            border-radius: 50%;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            to {
                transform: translateY(-10px);
                background: var(--pink-3);
            }
        }

        .report-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            margin: 30px auto;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(255, 182, 193, 0.3);
            display: none;
            text-align: left;
            animation: slideIn 0.5s forwards;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .metric {
            margin: 25px 0;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--pink-1);
        }

        .suggestion {
            background: rgba(255, 182, 193, 0.2);
            padding: 12px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .progress-bar {
            height: 8px;
            background: rgba(255, 182, 193, 0.3);
            border-radius: 4px;
            margin: 10px 0;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--pink-2), var(--pink-3));
            border-radius: 4px;
        }

        .share-btn {
            background: linear-gradient(45deg, var(--pink-2), var(--pink-3));
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .share-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px var(--pink-2);
        }

        footer {
            margin-top: auto;
            padding: 20px;
            font-size: 1.2em;
            color: var(--pink-3);
            animation: fadeIn 1s;
        }

        .cute-emoji {
            font-size: 1.5em;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <h1>LoveLens AI - Your Love Analyzer ðŸ’–</h1>
    <p>Upload your chat screenshot and discover your love story! âœ¨</p>
    
    <div class="upload-container">
        <div class="upload-zone" id="uploadZone" title="Click or drag your chat screenshot here">
            <div class="upload-icon">
                <i class="fas fa-heart" style="font-size: 50px; color: var(--pink-2);"></i>
            </div>
            <p>Click or drop your chat screenshot here</p>
            <input type="file" id="fileInput" accept="image/*" style="display: none;">
            <img id="previewImage" alt="Preview">
        </div>
        
        <button class="analyze-btn" id="analyzeBtn" disabled>Analyze Love</button>
        
        <div class="loading" id="loading">
            <p>Your chats are end-to-end encrypted.</p>
            <div class="loading-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
            </div>
            <p>Reading your sweet messages... ðŸŒ¸</p>
        </div>
    </div>
    
    <div class="report-card" id="reportCard">
        <h2 style="color: var(--pink-3);">Your Love Report ðŸ’˜</h2>
        <p style="text-align: center;">Generated on <span id="reportDate"></span></p>
        
        <div id="analysisResults"></div>

        <button class="share-btn" onclick="downloadReport()">Download This Report as Image ðŸ’Œ</button>
    </div>

    <footer>
        Made for fun! ðŸŽ‰ðŸ’•âœ¨
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadZone = document.getElementById('uploadZone');
        const previewImage = document.getElementById('previewImage');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const loading = document.getElementById('loading');
        const reportCard = document.getElementById('reportCard');
        const reportDateElem = document.getElementById('reportDate');
        let mockChatData = { messages: [], analysisDate: new Date().toLocaleDateString() };

        uploadZone.addEventListener('click', () => fileInput.click());
        uploadZone.addEventListener('dragover', e => {
            e.preventDefault();
            uploadZone.style.borderColor = "var(--pink-3)";
        });
        uploadZone.addEventListener('dragleave', () => {
            uploadZone.style.borderColor = "var(--pink-2)";
        });
        uploadZone.addEventListener('drop', e => {
            e.preventDefault();
            uploadZone.style.borderColor = "var(--pink-2)";
            if (e.dataTransfer.files.length) handleImageUpload(e.dataTransfer.files[0]);
        });

        fileInput.addEventListener('change', e => {
            if (e.target.files.length) handleImageUpload(e.target.files[0]);
        });

        function handleImageUpload(file) {
            const reader = new FileReader();
            reader.onload = e => {
                previewImage.src = e.target.result;
                previewImage.style.display = 'block';
                analyzeBtn.disabled = false;
                uploadZone.querySelector('p').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        analyzeBtn.addEventListener('click', analyzeChat);
        
        function analyzeChat() {
            mockChatData.messages = [
                { sender: 'user', text: 'Good morning beautiful! ðŸŒ¸', time: '09:00' },
                { sender: 'partner', text: 'Morning my love ðŸ˜˜', time: '09:01' },
                { sender: 'user', text: 'What are your plans for today?', time: '09:05' },
                { sender: 'partner', text: 'Just missing you ðŸ’–', time: '09:07' },
            ];

            loading.style.display = 'block';
            uploadZone.style.display = 'none';
            analyzeBtn.style.display = 'none';
            reportDateElem.textContent = mockChatData.analysisDate;

            setTimeout(() => {
                loading.style.display = 'none';
                generateReport();
                reportCard.style.display = 'block';
            }, 2000); // Simulating processing time of 2 seconds
        }

        function generateReport() {
            const metrics = [
                { title: 'ðŸ’ž Affection Level', ...analyzeAffection(mockChatData.messages) },
                { title: 'ðŸ«‚ Pet Name Sweetness', ...analyzePetNames(mockChatData.messages) },
                { title: 'â±ï¸ Response Speed', ...analyzeResponseTime(mockChatData.messages) },
                { title: 'ðŸ’¬ Conversation Depth', ...analyzeConversationDepth(mockChatData.messages) },
                { title: 'ðŸ˜˜ Flirt Level', ...analyzeFlirting(mockChatData.messages) },
                { title: 'ðŸ˜Š Emoji Chemistry', ...analyzeEmojiChemistry(mockChatData.messages) },
                { title: 'ðŸŒ™ Late Night Chats', ...analyzeLateNightChats(mockChatData.messages) },
                { title: 'âœ¨ Future Potential', ...analyzeFuturePotential(mockChatData.messages) }
            ];
            
            displayAnalysis(metrics);
        }

        function analyzeAffection(messages) {
            const heartEmojis = messages.filter(msg =>
                msg.text.match(/â¤ï¸|ðŸ’–|ðŸ’˜|ðŸ˜˜|ðŸ’•|ðŸ’“|ðŸ’—|ðŸ’ž/g)
            ).length;
            const score = Math.min(100, heartEmojis * 15);
            let comment, suggestion;

            if (score >= 80) {
                comment = `You're conveying a lot of affection with ${heartEmojis} heart emojis! Keep it up! ðŸ’˜`;
                suggestion = "Try expressing feelings through voice notes!";
            } else if (score >= 50) {
                comment = `You have used ${heartEmojis} affectionate emojis, nice job!`;
                suggestion = "Add more heart emojis in your chats!";
            } else {
                comment = "Consider using more heart emojis to express your love!";
                suggestion = "Send a beautiful surprise â¤ï¸ today!";
            }
            
            return { score, comment, suggestion };
        }

        function analyzePetNames(messages) {
            const petNames = messages
                .flatMap(msg => msg.text.match(/\b(babe|baby|love|jaan|dear|sweetheart|angel)\b/gi) || []);
            const uniqueNames = [...new Set(petNames)];
            const score = Math.min(100, petNames.length * 20);
            let comment, suggestion;

            if (score >= 80) {
                comment = `Such cuteness! Most used: "${mostFrequent(petNames)}" (${petNames.length} times)`;
                suggestion = "Consider adding a fun nickname!";
            } else if (score >= 40) {
                comment = `${petNames.length} endearing names noted: ${uniqueNames.join(', ')}`;
                suggestion = "Try a unique nickname like 'Cutie Pie'!";
            } else {
                comment = "Let's spice up your nickname game!";
                suggestion = "Use 'Sweetheart' or something special today!";
            }
            
            return { score, comment, suggestion };
        }

        function analyzeResponseTime(messages) {
            const responseTimes = [];
            messages.forEach((msg, i) => {
                if (i > 0 && msg.sender !== messages[i-1].sender) {
                    responseTimes.push(6); // Uniform time of 6 seconds
                }
            });
            const avgTime = average(responseTimes);
            let score, comment, suggestion;

            if (avgTime <= 5) {
                score = 100;
                comment = "âš¡ You're super quick at replying!";
                suggestion = "Keep that energy for fun conversations!";
            } else if (avgTime <= 15) {
                score = 80;
                comment = `On average, it takes you about ${avgTime} seconds to reply.`;
                suggestion = "Feel free to send a sweet text while you wait!";
            } else {
                score = 60;
                comment = `It takes you an average of ${avgTime} seconds to respond.`;
                suggestion = "Consider sending a fun meme to boost engagement!";
            }
            
            return { score, comment, suggestion };
        }

        function analyzeConversationDepth(messages) {
            const deepKeywords = ['why', 'feel', 'think', 'believe', 'love', 'dream'];
            const deepMessages = messages.filter(msg =>
                deepKeywords.some(kw => msg.text.toLowerCase().includes(kw))
            ).length;

            const score = Math.min(100, (deepMessages / messages.length) * 100);
            let comment, suggestion;

            if (score >= 75) {
                comment = `${deepMessages} deep conversations detected! Emotional connection is strong ðŸ’ž`;
                suggestion = "Keep nurturing these deep discussions!";
            } else if (score >= 40) {
                comment = `${deepMessages} meaningful exchanges found, good job.`;
                suggestion = "Ask more about their feelings or dreams!";
            } else {
                comment = "Let's explore more meaningful communication!";
                suggestion = "Try asking 'What made you happiest today?'";
            }
            
            return { score, comment, suggestion };
        }

        function analyzeFlirting(messages) {
            const flirtWords = ['cute', 'hot', 'sexy', 'miss you', 'kiss', 'hug'];
            const flirtCount = messages.filter(msg =>
                flirtWords.some(word => msg.text.toLowerCase().includes(word))
            ).length;

            const score = Math.min(100, flirtCount * 20);
            let comment, suggestion;

            if (score >= 80) {
                comment = `${flirtCount} flirty messages! You are so smooth ðŸ˜‰`;
                suggestion = "Try adding a playful compliment!";
            } else if (score >= 50) {
                comment = `${flirtCount} playful remarks noticed. Keep it going!`;
                suggestion = "Consider adding small, sweet compliments occasionally.";
            } else {
                comment = "Let's sprinkle in more flirtatious compliments!";
                suggestion = "Try complimenting their looks today!";
            }
            
            return { score, comment, suggestion };
        }

        function analyzeEmojiChemistry(messages) {
            const emojiCount = messages
                .map(msg => (msg.text.match(/[\u{1F600}-\u{1F64F}]/gu) || []).length)
                .reduce((a, b) => a + b, 0);

            const score = Math.min(100, emojiCount * 5);
            let comment, suggestion;

            if (score >= 80) {
                comment = `${emojiCount} emojis exchanged! You speak the love language ðŸ’«`;
                suggestion = "Mixed emojis can bring surprises!";
            } else if (score >= 50) {
                comment = `${emojiCount} emojis exchanged, very nice!`;
                suggestion = "React with a cute emoji to brighten their day!";
            } else {
                comment = "More emojis would add fun to your conversations!";
                suggestion = "Start with adding one ðŸ˜Š per message!";
            }
            
            return { score, comment, suggestion };
        }

        function analyzeLateNightChats(messages) {
            const nightMessages = messages.filter(msg => {
                const hour = parseInt(msg.time.split(':')[0]);
                return hour >= 22 || hour <= 3;
            }).length;

            const score = Math.min(100, nightMessages * 15);
            let comment, suggestion;

            if (score >= 80) {
                comment = `${nightMessages} late-night conversations! You light up their nights ðŸŒ™`;
                suggestion = "Consider a sweet text to say goodnight!";
            } else if (score >= 50) {
                comment = `${nightMessages} messages after 10 PM detected - quite romantic!`;
                suggestion = "Try texting 'I miss you' at midnight!";
            } else {
                comment = "Late-night chats add intimacy!";
                suggestion = "Text them 'Thinking of you' tonight!";
            }
            
            return { score, comment, suggestion };
        }

        function analyzeFuturePotential(messages) {
            const futureWords = ['tomorrow', 'next week', 'always', 'forever', 'future', 'together'];
            const futureCount = messages.filter(msg =>
                futureWords.some(word => msg.text.toLowerCase().includes(word))
            ).length;

            const score = Math.min(100, futureCount * 20);
            let comment, suggestion;

            if (score >= 80) {
                comment = `${futureCount} conversations about the future! Planning for forever ðŸ’`;
                suggestion = "Make some future plans together soon!";
            } else if (score >= 50) {
                comment = `${futureCount} discussions about future aspirations found.`;
                suggestion = "Ask about their future dreams!";
            } else {
                comment = "Future discussions might strengthen your bond!";
                suggestion = "Try suggesting a fun activity together soon!";
            }
            
            return { score, comment, suggestion };
        }

        function mostFrequent(arr) {
            return arr.sort((a, b) => 
                arr.filter(v => v === a).length - arr.filter(v => v === b).length
            ).pop();
        }

        function average(arr) {
            return arr.length ? Math.round(arr.reduce((a, b) => a + b) / arr.length) : 0;
        }

        function displayAnalysis(metrics) {
            const container = document.getElementById('analysisResults');
            container.innerHTML = metrics.map(metric => `
                <div class="metric">
                    <h3>${metric.title}</h3>
                    <div class="progress-bar">
                        <div class="progress" style="width: ${metric.score}%"></div>
                    </div>
                    <p>${metric.comment}</p>
                    ${metric.suggestion ? `
                        <div class="suggestion">
                            ðŸ’¡ <b>Try:</b> ${metric.suggestion}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function downloadReport() {
            // Temporarily hide the download button to avoid it appearing in the screenshot
            const shareBtn = document.querySelector('.share-btn');
            shareBtn.style.display = 'none';
            
            // Add a small delay to ensure the button is hidden before capturing
            setTimeout(() => {
                html2canvas(document.querySelector("#reportCard"), {
                    scale: 2, // Higher quality
                    logging: false,
                    useCORS: true,
                    allowTaint: true
                }).then(canvas => {
                    // Restore the button
                    shareBtn.style.display = '';
                    
                    const link = document.createElement('a');
                    link.download = 'love_report.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                }).catch(err => {
                    console.error('Error generating image:', err);
                    shareBtn.style.display = '';
                    alert('Error generating report image. Please try again.');
                });
            }, 100);
        }
    </script>
</body>
</html>
